{% extends 'frame.html' %}
{% block title %}home{% endblock %}
{% block content %}
<script src="/static/js/pagination.js" type="text/javascript"></script>
<link href="/static/css/style.css" rel="stylesheet" type="text/css" />

<script type="text/javascript">
  $(document).ready(function() {
     
     $("#submit-button").click(function(){
        var intRegex = /^\d+$/;

        var today = new Date();
        var dd = today.getDate();
        var mm = today.getMonth()+1; //January is 0!
        var yyyy = today.getFullYear();
        var inputdate = $("#date").val().split("-");
        if ((!intRegex.test(inputdate[0])) || (!intRegex.test(inputdate[1])) || (!intRegex.test(inputdate[2])))
        {
          alert('Please input correct date');
          return false;
        }
        else {
          var d=parseInt(inputdate[2]);
          var m=parseInt(inputdate[1]);
          var y=parseInt(inputdate[0]);
          if ((y!=2013)||(m>mm)||((m==mm)&&(d>=dd)))
          {
            alert('Please only input data PRIOR to today');
            return false;
          }
        }
        if(!intRegex.test($("#step").val()))
          alert("Step should be a non-negative integer");
        else if(!intRegex.test($("#calories").val())) 
          alert("Calories should be a non-negative integer")
        else if(!intRegex.test($("#fuel_score").val()))
          alert("Fuel score should be a non-negative integer")
        else   
	  $.get("/addrecord/", {       
          "step": $("#step").val(), "calories": $("#calories").val(), "fuel_score": $("#fuel_score").val(),
          "note": $("#note").val(), "date": $("#date").val()}).done(function(){
             location.reload(true); 
          });
        return false;
      });
      var yesterday = new Date();
      yesterday.setTime(yesterday.getTime() - (1000*3600*32)); //24+8 (UTC -8)    
      $("#date").val(yesterday.toJSON().substring(0,10));
  });
</script>
<div class="row">
    <div class="span8">
        <div class="container-fluid" style="padding:0">
         <div class="row-fluid">                             
          <div class="container-fluid" style="padding:0">
          <div class="span8">                                
           <div class="well">                                 
           <h3> Input your activity </h3>               
           <div class="row-fluid">
           <input class="input span4" type="text" id="step" name="step" placeholder="Steps" value="{{ step }}">
           </div>
           <div class="row-fluid">
           <input class="input span4" type="text" id="calories" name="calories" placeholder="Calorie" value="{{ calorie }}"> 
           </div>
           <div class="row-fluid">
           <input class="input span4" type="text" id="fuel_score" name="fuel_score" placeholder="FuelScore" value="{{ fuel_score }}">                                           
       </div>
           <input class="input span4" type="date" id="date" name="date" placeholder="date"">
           <button id="submit-button" name="submit-button" type="submit span2" class="btn btn-success btn-primary" style="float:right">Submit</button>                          
           </div>
           </div>
          <div class="span4">
              <div class="container-fluid" style="padding:0">
                  <div class="row-fluid">
              <div class="span12">
                <button class="btn btn-large btn-info" style="margin: 5px; width:100%; height: 75px">Game!</button>
            </div>
        </div>
        <div class="row-fluid">
              <div class="span12">
                <button class="btn btn-large btn-success" style="margin:5px; width:100%; height: 75px">What's this?</button>
            </div>
        </div>
        <div class="row-fluid">
              <div class="span12">
                <button class="btn btn-large btn-primary" style="margin:5px; width:100%; height: 75px">FAQ</button>
            </div>
        </div>
          </div>

          </div>
          </div>
          </div>
         <div class="row-fluid">
          <div class="span12">
            <p>
              <h3>List of Activities</h3>
            </p>
           <table class="table table-cordered table-striped" text-align="center">
            <thead>
	    <tr> 
              <th>Date</th>
              <th>Activity</th>
	      <th>Credit</th>
            </tr>
	    </thead>
	    <tbody>
            {% for amount in user.amount_set.all %}
	     <tr>
              <td>{{ amount.get_date }}</td>
              <td>{{ amount.action }}</td>
              <!--{% if amount.atype == 1 %}
                 <td>{{ amount.record.steps }}</td>
                 <td>{{ amount.record.calories }}</td>
                 <td> {{ amount.record.fuelscore }}</td>
              {% else %}
                 <td></td>
                 <td></td>
                 <td></td>
              {% endif %}-->
              <td>{{ amount }}</td>
             </tr>
	    {% endfor %}
            </tbody>
           </table>
	   </ul>
        </div>
       </div>
    </div>
   </div>
   <div class="span4">
     <div class="well">
       <h3>{{ user.get_full_name }}</h3>
       <h3> Credit: {{ user.profile.current_amount }}</h3>
        {% if user.profile.status == 'g' %}
        <span class="badge badge-warning">Gold</span>
        {% else %}
          {% if user.profile.status == 's' %}
          <span class="badge badge-default">Silver</span>
          {% else %}
            <span class="badge badge-important">Bronze</span>
          {% endif %}
        {% endif %} 
        <div class="progress progress-danger progress-striped" style="margin:10px">
            <div class="bar" style="width: {{ user.profile.progress }}%;"></div>
            {{ user.profile.progressinfo }}
        </div>
     </div>
     <h3 id="list">Ranklist</h3>
        
      <div class="well" style="padding: 8px 0;">
        <ul class="nav nav-list">
          <li><a href="#">1&nbsp&nbsp&nbspChenguang Zhu</a></li>
          <li><a href="#">2&nbsp&nbsp&nbspTom Yue</a></li>
          <li><a href="#">3&nbsp&nbsp&nbspBalaji</a></li>
          <li><a href="#">4&nbsp&nbsp&nbspChinmoy</a></li>
          <li><a href="#">5&nbsp&nbsp&nbspHossein</a></li>
          <li><a href="#">6&nbsp&nbsp&nbspCarrie</a></li>
          <li><a href="#">...</a></li>
          <li class="divider"></li>
          <li><a href="#">1&nbsp&nbsp&nbspYou</a></li>
        </ul>
      </div>
   </div>
</div>
{% endblock %}}
